# 字数设置功能修复说明

## 问题描述

在之前的版本中，当用户在弹幕页面调整字数设置并点击"应用设置"按钮后，WebSocket会发送一条更新参数的消息，但之后不会再收到新的弹幕消息，导致弹幕流中断。

## 问题原因

1. 后端在收到参数更新请求后，会停止当前会话并创建新会话，但没有向前端发送新的会话ID
2. 前端无法识别新会话的消息，导致无法接收后续弹幕

## 修复内容

1. **后端修复**：
   - 在参数更新后，立即向前端发送新的`session_start`消息
   - 在新会话消息中添加`is_update`标记，表明这是参数更新后的新会话
   - 确保新会话消息包含更新后的字数范围参数

2. **前端修复**：
   - 增强前端处理`session_start`消息的逻辑
   - 识别参数更新后的新会话，并更新会话ID
   - 添加字数更新成功的用户反馈提示

## 使用说明

修复后，用户可以在弹幕页面随时调整字数设置，系统会平滑过渡到新的字数范围，不会中断弹幕流。

当用户点击"应用设置"按钮后：
1. 系统会短暂切换到新的字数设置
2. 会出现一条提示消息，确认字数已更新
3. 随后新的弹幕将按照更新后的字数范围生成并显示

## 技术细节

- 修复了WebSocket消息处理中的会话同步问题
- 优化了前后端的状态同步机制
- 增强了用户操作的反馈体验
